<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Vista de búsqueda -->
    <record id="user_registration_search_view" model="ir.ui.view">
        <field name="name">user.registration.search</field>
        <field name="model">user_registration</field>
        <field name="arch" type="xml">
            <search string="Buscar Usuarios">
                <field name="primer_nombre" string="Nombre" filter_domain="['|', ('primer_nombre', 'ilike', self), ('segundo_nombre', 'ilike', self)]"/>
                <field name="primer_apellido" string="Apellido" filter_domain="['|', ('primer_apellido', 'ilike', self), ('segundo_apellido', 'ilike', self)]"/>
                <field name="cedula" string="Cédula"/>
                <field name="correo" string="Correo"/>
                <field name="telefono" string="Teléfono"/>
                <separator/>
                <filter string="Activos" name="active" domain="[('active', '=', True)]"/>
                <filter string="Inactivos" name="inactive" domain="[('active', '=', False)]"/>
                <filter string="Con Discapacidad" name="discapacidad" domain="[('discapacidad', '!=', 'ninguna')]"/>
                <group expand="0" string="Agrupar Por">
                    <filter string="Género" name="group_by_genero" context="{'group_by': 'genero'}"/>
                    <filter string="Grupo de Usuario" name="group_by_grupo" context="{'group_by': 'grupo_usuario'}"/>
                    <filter string="Etnia" name="group_by_etnia" context="{'group_by': 'etnia'}"/>
                </group>
            </search>
        </field>
    </record>

    <!-- Lista mejorada -->
    <record id="user_registration_view" model="ir.ui.view">
        <field name="name">user.registration.list</field>
        <field name="model">user_registration</field>
        <field name="arch" type="xml">
            <list string="Usuarios Registrados" decoration-danger="discapacidad != 'ninguna'" decoration-info="grupo_usuario == 'estudiante'" decoration-warning="grupo_usuario == 'profesor'" decoration-success="grupo_usuario in ['admin', 'superAdmin']">
                <field name="primer_nombre" string="Nombre"/>
                <field name="primer_apellido" string="Apellido"/>
                <field name="cedula" string="Cédula" widget="badge"/>
                <field name="correo" widget="email"/>
                <field name="telefono" widget="phone"/>
                <field name="grupo_usuario" string="Grupo"/>
                <field name="genero" optional="hide"/>
                <field name="fecha_nacimiento" optional="hide"/>
                <field name="etnia" optional="hide"/>
                <field name="active" widget="boolean_toggle" string="Estatus"/>
            </list>
        </field>
    </record>

    <!-- Vista Kanban -->
    <record id="user_registration_kanban_view" model="ir.ui.view">
        <field name="name">user.registration.kanban</field>
        <field name="model">user_registration</field>
        <field name="arch" type="xml">
            <kanban>
                <field name="id"/>
                <field name="primer_nombre"/>
                <field name="segundo_nombre"/>
                <field name="primer_apellido"/>
                <field name="segundo_apellido"/>
                <field name="cedula"/>
                <field name="correo"/>
                <field name="telefono"/>
                <field name="grupo_usuario"/>
                <field name="active"/>
                <field name="genero"/>
                <templates>
                    <t t-name="kanban-box">
                        <div t-attf-class="oe_kanban_global_click o_kanban_record_has_image_fill">
                            <div class="o_kanban_image_fill_left d-none d-md-block" t-attf-style="background-color: #{kanban_color(record.grupo_usuario.raw_value)}" role="img">
                                <span t-esc="record.primer_nombre.value[0] + record.primer_apellido.value[0]" class="o_kanban_image_text"/>
                            </div>
                            <div class="oe_kanban_details d-flex flex-column">
                                <strong class="o_kanban_record_title">
                                    <field name="cedula"/> - <field name="primer_nombre"/> <field name="primer_apellido"/>
                                </strong>
                                <div class="o_kanban_tags_section mb-2">
                                    <span t-attf-class="badge bg-#{record.grupo_usuario.raw_value == 'estudiante' ? 'info' : record.grupo_usuario.raw_value == 'profesor' ? 'warning' : 'success'}">
                                        <field name="grupo_usuario"/>
                                    </span>
                                </div>
                                <div>
                                    <i class="fa fa-envelope-o me-2" role="img" aria-label="Correo"/>
                                    <field name="correo"/>
                                </div>
                                <div>
                                    <i class="fa fa-phone me-2" role="img" aria-label="Teléfono"/>
                                    <field name="telefono"/>
                                </div>
                                <div t-if="record.discapacidad.raw_value != 'ninguna'" class="text-danger">
                                    <i class="fa fa-exclamation-triangle me-2" role="img" aria-label="Discapacidad"/>
                                    <field name="discapacidad"/>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <!-- Formulario mejorado -->
    <record id="user_registration_form_view" model="ir.ui.view">
        <field name="name">user.registration.form</field>
        <field name="model">user_registration</field>
        <field name="arch" type="xml">
            <form string="Registro de Usuario">
                <header>
                    <button name="toggle_active" type="object" string="Activar/Desactivar" class="btn-primary" invisible="active"/>
                </header>
                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button name="toggle_active" type="object" class="oe_stat_button" icon="fa-archive">
                            <field name="active" widget="boolean_button" options="{'terminology': 'archive'}"/>
                        </button>
                    </div>
                    <div class="oe_title">
                        <div class="o_avatar_upload_placeholder">
                            <field name="primer_nombre" invisible="1"/>
                            <field name="primer_apellido" invisible="1"/>
                        </div>
                    </div>
                    <group>
                        <group string="Información Personal">
                            <field name="primer_nombre" required="1"/>
                            <field name="segundo_nombre"/>
                            <field name="primer_apellido" required="1"/>
                            <field name="segundo_apellido"/>
                            <field name="cedula"  placeholder="Cédula"/>
                            <field name="genero" widget="radio"/>
                            <field name="fecha_nacimiento" widget="date" options="{'datepicker': {'maxDate': '-18y'}}"/>
                        </group>
                        
                        <group string="Datos de Contacto">
                            <field name="cedula" required="1" placeholder="Ej: 001-1234567-8"/>
                            <field name="correo" widget="email" placeholder="ejemplo@dominio.com"/>
                            <field name="telefono" widget="phone" placeholder="809-555-5555"/>
                        </group>
                    </group>
                    
                    <notebook>
                        <page string="Detalles Adicionales">
                            <group>
                                <field name="discapacidad" widget="radio"/>
                                <field name="etnia"/>
                                <field name="active" widget="boolean_toggle" string="Estatus"/>
                                <field name="grupo_usuario" options="{'no_open': True}"/>
                            </group>
                        </page>
                        <page string="Historial">
                            <group>
                                <field name="create_date" readonly="1" string="Fecha de registro"/>
                                <field name="write_date" readonly="1" string="Última modificación"/>
                            </group>
                        </page>
                    </notebook>
                    
                </sheet>
            </form>
        </field>
    </record>

    <!-- Acción mejorada -->
    <record id="user_registration_action" model="ir.actions.act_window">
        <field name="name">Gestión de Usuarios</field>
        <field name="res_model">user_registration</field>
        <field name="view_mode">kanban,list,form</field>
        <field name="search_view_id" ref="user_registration_search_view"/>
        <field name="context">{'default_active': True, 'search_default_active': True}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">Crea un nuevo usuario</p>
            <p>Registra nuevos usuarios en el sistema con su información personal y asigna los permisos correspondientes.</p>
        </field>
    </record>
</odoo>