<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Portal Mi Admisión -->
    <template id="portal_mi_admision" name="Mi Admisión">
        <t t-call="portal.portal_layout">
            <div class="o_portal_my_home">
                <div class="oe_structure">
                    <div class="container">
                        <h1 class="o_page_header mt-3">Mi Admisión</h1>
                        
                        <!-- Información del Aspirante -->
                        <div class="card mt-4">
                            <div class="card-header">
                                <h4>Información Personal</h4>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <p><strong>Cédula:</strong> <span t-field="aspirante.cedula"/></p>
                                        <p><strong>Nombre:</strong> <span t-field="aspirante.partner_id.name"/></p>
                                        <p><strong>Tipo de Asignación:</strong> 
                                            <span t-if="aspirante.tipo_asignacion == 'opsu'" class="badge badge-info">OPSU</span>
                                            <span t-elif="aspirante.tipo_asignacion == 'rector'" class="badge badge-warning">Aprobación Rector</span>
                                            <span t-elif="aspirante.tipo_asignacion == 'secretaria'" class="badge badge-warning">Aprobación Secretaría</span>
                                            <span t-elif="aspirante.tipo_asignacion == 'dace'" class="badge badge-warning">Aprobación DACE</span>
                                            <span t-else="" class="badge badge-secondary">Aspirante a Cupo</span>
                                        </p>
                                    </div>
                                    <div class="col-md-6">
                                        <p><strong>Programa:</strong> <span t-field="aspirante.programa_id.name"/></p>
                                        <p><strong>Sede:</strong> <span t-field="aspirante.sede_id.name"/></p>
                                        <p><strong>Estado:</strong> 
                                            <span t-if="aspirante.state == 'registrado'" class="badge badge-secondary">Registrado</span>
                                            <span t-elif="aspirante.state == 'preinscrito'" class="badge badge-warning">Preinscrito</span>
                                            <span t-elif="aspirante.state == 'inscrito'" class="badge badge-success">Inscrito</span>
                                            <span t-elif="aspirante.state == 'estudiante'" class="badge badge-primary">Estudiante</span>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Información de Preinscripción -->
                        <div class="card mt-4" t-if="aspirante.state in ['preinscrito', 'inscrito', 'estudiante']">
                            <div class="card-header">
                                <div class="row">
                                    <div class="col-md-6">
                                        <h4>Preinscripción</h4>
                                    </div>
                                    <div class="col-md-6 text-right">
                                        <a t-if="preinscripcion" t-att-href="'/mi/admision/constancia/preinscripcion/%s' % preinscripcion.id" class="btn btn-sm btn-primary">
                                            <i class="fa fa-download"></i> Descargar Comprobante
                                        </a>
                                    </div>
                                </div>
                            </div>
                            <div class="card-body">
                                <t t-if="preinscripcion">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <p><strong>Número:</strong> <span t-field="preinscripcion.numero_preinscripcion"/></p>
                                            <p><strong>Fecha:</strong> <span t-field="preinscripcion.fecha_preinscripcion"/></p>
                                            <p><strong>Estado:</strong> 
                                                <span t-if="preinscripcion.state == 'draft'" class="badge badge-warning">Borrador</span>
                                                <span t-elif="preinscripcion.state == 'confirmed'" class="badge badge-success">Confirmada</span>
                                            </p>
                                        </div>
                                        <div class="col-md-6">
                                            <p><strong>Proceso:</strong> <span t-field="preinscripcion.proceso_id.name"/></p>
                                            <p><strong>Periodo:</strong> <span t-field="preinscripcion.proceso_id.periodo_id.name"/></p>
                                        </div>
                                    </div>
                                </t>
                                <t t-else="">
                                    <div class="alert alert-info">
                                        No se encontró una preinscripción registrada.
                                    </div>
                                </t>
                            </div>
                        </div>
                        
                        <!-- Preinscripción en Línea -->
                        <div class="card mt-4" t-if="aspirante.state == 'registrado'">
                            <div class="card-header">
                                <h4>Preinscripción en Línea</h4>
                            </div>
                            <div class="card-body">
                                <p>Para comenzar el proceso de admisión, debe realizar su preinscripción en línea.</p>
                                <a href="/mi/admision/preinscripcion/nueva" class="btn btn-primary">
                                    <i class="fa fa-pencil"></i> Realizar Preinscripción
                                </a>
                            </div>
                        </div>
                        
                        <!-- Información de Inscripción -->
                        <div class="card mt-4" t-if="aspirante.state in ['inscrito', 'estudiante']">
                            <div class="card-header">
                                <div class="row">
                                    <div class="col-md-6">
                                        <h4>Inscripción</h4>
                                    </div>
                                    <div class="col-md-6 text-right">
                                        <a t-if="inscripcion" t-att-href="'/mi/admision/constancia/inscripcion/%s' % inscripcion.id" class="btn btn-sm btn-primary">
                                            <i class="fa fa-download"></i> Descargar Constancia
                                        </a>
                                    </div>
                                </div>
                            </div>
                            <div class="card-body">
                                <t t-if="inscripcion">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <p><strong>Número:</strong> <span t-field="inscripcion.numero_inscripcion"/></p>
                                            <p><strong>Fecha:</strong> <span t-field="inscripcion.fecha_inscripcion"/></p>
                                            <p><strong>Estado:</strong> 
                                                <span t-if="inscripcion.state == 'draft'" class="badge badge-warning">Borrador</span>
                                                <span t-elif="inscripcion.state == 'confirmed'" class="badge badge-success">Confirmada</span>
                                            </p>
                                        </div>
                                        <div class="col-md-6">
                                            <p><strong>Sección:</strong> <span t-field="inscripcion.seccion_id.name"/></p>
                                            <p><strong>Documentos Completos:</strong> 
                                                <span t-if="inscripcion.documentacion_completa" class="badge badge-success">Sí</span>
                                                <span t-else="" class="badge badge-danger">No</span>
                                            </p>
                                        </div>
                                    </div>
                                </t>
                                <t t-else="">
                                    <div class="alert alert-info">
                                        No se encontró una inscripción registrada.
                                    </div>
                                </t>
                            </div>
                        </div>
                        
                        <!-- Horario -->
                        <div class="card mt-4" t-if="aspirante.state == 'estudiante' and horarios">
                            <div class="card-header">
                                <h4>Horario de Clases</h4>
                            </div>
                            <div class="card-body">
                                <table class="table table-bordered table-sm">
                                    <thead>
                                        <tr>
                                            <th>Asignatura</th>
                                            <th>Profesor</th>
                                            <th>Día</th>
                                            <th>Hora</th>
                                            <th>Aula</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <t t-foreach="horarios" t-as="h">
                                            <tr>
                                                <td><span t-field="h.asignatura"/></td>
                                                <td><span t-field="h.profesor"/></td>
                                                <td>
                                                    <t t-if="h.dia_semana == '1'">Lunes</t>
                                                    <t t-elif="h.dia_semana == '2'">Martes</t>
                                                    <t t-elif="h.dia_semana == '3'">Miércoles</t>
                                                    <t t-elif="h.dia_semana == '4'">Jueves</t>
                                                    <t t-elif="h.dia_semana == '5'">Viernes</t>
                                                    <t t-elif="h.dia_semana == '6'">Sábado</t>
                                                    <t t-else="">Domingo</t>
                                                </td>
                                                <td><span t-field="h.hora_inicio"/> - <span t-field="h.hora_fin"/></td>
                                                <td><span t-field="h.aula"/></td>
                                            </tr>
                                        </t>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <!-- Constancias -->
                        <div class="card mt-4" t-if="aspirante.state == 'estudiante'">
                            <div class="card-header">
                                <h4>Constancias</h4>
                            </div>
                            <div class="card-body">
                                <a href="/mi/admision/constancia/estudio/0" class="btn btn-primary">
                                    <i class="fa fa-download"></i> Descargar Constancia de Estudio
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>
    
    <!-- Template para cuando no hay proceso activo -->
    <template id="portal_no_proceso_activo" name="No hay proceso activo">
        <t t-call="portal.portal_layout">
            <div class="container mt-4">
                <div class="alert alert-warning">
                    <h4>No hay procesos activos</h4>
                    <p>Actualmente no hay procesos de preinscripción disponibles. Por favor, intente más tarde.</p>
                </div>
                <div class="mt-3">
                    <a href="/mi/admision" class="btn btn-secondary">Volver</a>
                </div>
            </div>
        </t>
    </template>
    
    <!-- Template para nueva preinscripción -->
    <template id="portal_nueva_preinscripcion" name="Nueva Preinscripción">
        <t t-call="portal.portal_layout">
            <div class="container mt-4">
                <h1>Preinscripción en Línea</h1>
                <div class="alert alert-info">
                    <p><strong>Proceso:</strong> <span t-field="proceso.name"/></p>
                    <p><strong>Periodo:</strong> <span t-field="proceso.periodo_id.name"/></p>
                    <p><strong>Fechas:</strong> Del <span t-field="proceso.fecha_inicio"/> al <span t-field="proceso.fecha_fin"/></p>
                </div>
                
                <t t-if="error_message">
                    <div class="alert alert-danger">
                        <p><t t-esc="error_message"/></p>
                    </div>
                </t>
                
                <form action="/mi/admision/preinscripcion/enviar" method="post" class="mt-4">
                    <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                    <input type="hidden" name="proceso_id" t-att-value="proceso.id"/>
                    
                    <div class="card mb-4">
                        <div class="card-header">
                            <h4>Datos Académicos</h4>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="promedio_bachillerato">Promedio Bachillerato</label>
                                        <input type="number" name="promedio_bachillerato" class="form-control" required="required" 
                                               min="10" max="20" step="0.01" t-att-value="form_data.get('promedio_bachillerato', '')"/>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="ano_graduacion">Año de Graduación</label>
                                        <input type="number" name="ano_graduacion" class="form-control" required="required" 
                                               min="1980" max="2030" t-att-value="form_data.get('ano_graduacion', '')"/>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="institucion_procedencia">Institución de Procedencia</label>
                                <input type="text" name="institucion_procedencia" class="form-control" required="required" 
                                       t-att-value="form_data.get('institucion_procedencia', '')"/>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="ingreso_familiar">Ingreso Familiar</label>
                                        <select name="ingreso_familiar" class="form-control" required="required">
                                            <option value="bajo" t-att-selected="form_data.get('ingreso_familiar') == 'bajo'">Bajo</option>
                                            <option value="medio_bajo" t-att-selected="form_data.get('ingreso_familiar') == 'medio_bajo'">Medio Bajo</option>
                                            <option value="medio" t-att-selected="form_data.get('ingreso_familiar') == 'medio'">Medio</option>
                                            <option value="medio_alto" t-att-selected="form_data.get('ingreso_familiar') == 'medio_alto'">Medio Alto</option>
                                            <option value="alto" t-att-selected="form_data.get('ingreso_familiar') == 'alto'">Alto</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group mt-4">
                                        <div class="form-check">
                                            <input type="checkbox" name="trabaja" class="form-check-input" id="trabaja" 
                                                   t-att-checked="form_data.get('trabaja') == 'on'"/>
                                            <label class="form-check-label" for="trabaja">¿Trabaja Actualmente?</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group" id="trabajo_div" style="display: none;">
                                <label for="empresa_trabajo">Empresa donde Trabaja</label>
                                <input type="text" name="empresa_trabajo" class="form-control" 
                                       t-att-value="form_data.get('empresa_trabajo', '')"/>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card mb-4">
                        <div class="card-header">
                            <h4>Dirección</h4>
                        </div>
                        <div class="card-body">
                            <div class="form-group">
                                <label for="direccion_completa">Dirección Completa</label>
                                <textarea name="direccion_completa" class="form-control" rows="3" required="required"><t t-esc="form_data.get('direccion_completa', '')"/></textarea>
                            </div>
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label for="estado">Estado</label>
                                        <input type="text" name="estado" class="form-control" required="required" 
                                               t-att-value="form_data.get('estado', '')"/>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label for="municipio">Municipio</label>
                                        <input type="text" name="municipio" class="form-control" required="required" 
                                               t-att-value="form_data.get('municipio', '')"/>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label for="parroquia">Parroquia</label>
                                        <input type="text" name="parroquia" class="form-control" required="required" 
                                               t-att-value="form_data.get('parroquia', '')"/>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="codigo_postal">Código Postal</label>
                                <input type="text" name="codigo_postal" class="form-control" 
                                       t-att-value="form_data.get('codigo_postal', '')"/>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card mb-4">
                        <div class="card-header">
                            <h4>Contacto de Emergencia</h4>
                        </div>
                        <div class="card-body">
                            <div class="form-group">
                                <label for="contacto_emergencia">Nombre Contacto de Emergencia</label>
                                <input type="text" name="contacto_emergencia" class="form-control" required="required" 
                                       t-att-value="form_data.get('contacto_emergencia', '')"/>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="telefono_emergencia">Teléfono de Emergencia</label>
                                        <input type="text" name="telefono_emergencia" class="form-control" required="required" 
                                               t-att-value="form_data.get('telefono_emergencia', '')"/>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="relacion_contacto">Relación con el Contacto</label>
                                        <input type="text" name="relacion_contacto" class="form-control" required="required" 
                                               t-att-value="form_data.get('relacion_contacto', '')"/>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group mt-4">
                        <div class="d-flex">
                            <button type="submit" class="btn btn-primary mr-2">Enviar Preinscripción</button>
                            <a href="/mi/admision" class="btn btn-secondary">Cancelar</a>
                        </div>
                    </div>
                </form>
                
                <script>
                    document.addEventListener('DOMContentLoaded', function() {
                        const trabajaCheck = document.getElementById('trabaja');
                        const trabajoDiv = document.getElementById('trabajo_div');
                        
                        // Función para mostrar/ocultar campo de empresa
                        function toggleTrabajoDiv() {
                            if (trabajaCheck.checked) {
                                trabajoDiv.style.display = 'block';
                            } else {
                                trabajoDiv.style.display = 'none';
                            }
                        }
                        
                        // Aplicar estado inicial
                        toggleTrabajoDiv();
                        
                        // Añadir evento de cambio
                        trabajaCheck.addEventListener('change', toggleTrabajoDiv);
                    });
                </script>
            </div>
        </t>
    </template>
        <!-- Vista de preinscripción -->
    <template id="portal_ver_preinscripcion" name="Ver Preinscripción">
        <t t-call="portal.portal_layout">
            <div class="container mt-4">
                <h1>Preinscripción</h1>
                
                <t t-if="request.params.get('success')">
                    <div class="alert alert-success">
                        <p><strong>¡Éxito!</strong> Su preinscripción ha sido registrada correctamente.</p>
                    </div>
                </t>
                
                <div class="card mb-4">
                    <div class="card-header">
                        <div class="row">
                            <div class="col-md-6">
                                <h4>Datos de la Preinscripción</h4>
                            </div>
                            <div class="col-md-6 text-right">
                                <a t-att-href="'/mi/admision/constancia/preinscripcion/%s' % preinscripcion.id" class="btn btn-primary btn-sm">
                                    <i class="fa fa-download"></i> Descargar Comprobante
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <p><strong>Número:</strong> <span t-field="preinscripcion.numero_preinscripcion"/></p>
                                <p><strong>Fecha:</strong> <span t-field="preinscripcion.fecha_preinscripcion"/></p>
                                <p><strong>Estado:</strong> 
                                    <span t-if="preinscripcion.state == 'draft'" class="badge badge-warning">Borrador</span>
                                    <span t-elif="preinscripcion.state == 'confirmed'" class="badge badge-success">Confirmada</span>
                                </p>
                            </div>
                            <div class="col-md-6">
                                <p><strong>Programa:</strong> <span t-field="preinscripcion.programa_id.name"/></p>
                                <p><strong>Sede:</strong> <span t-field="preinscripcion.sede_id.name"/></p>
                                <p><strong>Proceso:</strong> <span t-field="preinscripcion.proceso_id.name"/></p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card mb-4">
                    <div class="card-header">
                        <h4>Datos Académicos</h4>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <p><strong>Promedio Bachillerato:</strong> <span t-field="preinscripcion.promedio_bachillerato"/></p>
                                <p><strong>Año de Graduación:</strong> <span t-field="preinscripcion.ano_graduacion"/></p>
                                <p><strong>Institución de Procedencia:</strong> <span t-field="preinscripcion.institucion_procedencia"/></p>
                            </div>
                            <div class="col-md-6">
                                <p><strong>Ingreso Familiar:</strong> 
                                    <t t-if="preinscripcion.ingreso_familiar == 'bajo'">Bajo</t>
                                    <t t-elif="preinscripcion.ingreso_familiar == 'medio_bajo'">Medio Bajo</t>
                                    <t t-elif="preinscripcion.ingreso_familiar == 'medio'">Medio</t>
                                    <t t-elif="preinscripcion.ingreso_familiar == 'medio_alto'">Medio Alto</t>
                                    <t t-else="">Alto</t>
                                </p>
                                <p><strong>Trabaja Actualmente:</strong> 
                                    <span t-if="preinscripcion.trabaja" class="badge badge-info">Sí</span>
                                    <span t-else="" class="badge badge-secondary">No</span>
                                </p>
                                <p t-if="preinscripcion.trabaja"><strong>Empresa:</strong> <span t-field="preinscripcion.empresa_trabajo"/></p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card mb-4">
                    <div class="card-header">
                        <h4>Dirección</h4>
                    </div>
                    <div class="card-body">
                        <p><strong>Dirección Completa:</strong> <span t-field="preinscripcion.direccion_completa"/></p>
                        <div class="row">
                            <div class="col-md-4">
                                <p><strong>Estado:</strong> <span t-field="preinscripcion.estado"/></p>
                            </div>
                            <div class="col-md-4">
                                <p><strong>Municipio:</strong> <span t-field="preinscripcion.municipio"/></p>
                            </div>
                            <div class="col-md-4">
                                <p><strong>Parroquia:</strong> <span t-field="preinscripcion.parroquia"/></p>
                            </div>
                        </div>
                        <p><strong>Código Postal:</strong> <span t-field="preinscripcion.codigo_postal"/></p>
                    </div>
                </div>
                
                <div class="card mb-4">
                    <div class="card-header">
                        <h4>Contacto de Emergencia</h4>
                    </div>
                    <div class="card-body">
                        <p><strong>Nombre:</strong> <span t-field="preinscripcion.contacto_emergencia"/></p>
                        <p><strong>Teléfono:</strong> <span t-field="preinscripcion.telefono_emergencia"/></p>
                        <p><strong>Relación:</strong> <span t-field="preinscripcion.relacion_contacto"/></p>
                    </div>
                </div>
                
                <div class="alert alert-info mt-4">
                    <h5>Próximos Pasos:</h5>
                    <p>Para formalizar su inscripción, deberá presentarse en la oficina de Control de Estudios correspondiente a su sede según el cronograma establecido, con la siguiente documentación:</p>
                    <ul>
                        <li>Original y copia de la Cédula de Identidad</li>
                        <li>Original y copia del Título de Bachiller</li>
                        <li>Original y copia de las Notas Certificadas</li>
                        <li>Dos (2) fotografías recientes tipo carné</li>
                        <li>Original y copia de la Partida de Nacimiento</li>
                    </ul>
                </div>
                
                <div class="mt-3">
                    <a href="/mi/admision" class="btn btn-secondary">Volver a Mi Admisión</a>
                </div>
            </div>
        </t>
    </template>
</odoo>